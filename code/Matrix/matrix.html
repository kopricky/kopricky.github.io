<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> My Algorithm : kopricky アルゴリズムライブラリ </title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="競技プログラミングで使われるアルゴリズムのコード集">
<meta name="keywords" content="競技プログラミング,競プロ,アルゴリズム,コード,kopricky,computation,datastructure,geometry,graph,networkflow,string,icpc,Atcoder">
<link rel="stylesheet" href="../../css/style.css">
<script type="text/javascript" src="../../js/openclose.js"></script>
<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
<link rel="stylesheet" href="../../css/prettify.css" type="text/css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

<div id="container">

<header>
<h1 id="logo"><a href="../../index.html"><img src="../../images/logo.png" alt="kopricky アルゴリズムライブラリ"></a></h1>
</header>


<nav id="menubar">
<ul>
<li><a href="../../index.html">Home</a></li>
<li><a href="../../guide.html">Guide</a></li>
<li class="current"><a href="../../code.html">Code</a></li>
<li><a href="../../link.html">Link</a></li>
</ul>
</nav>

<div id="contents">

<section>
<h2>Matrix</h2>
<h3>コードについての説明</h3>
<p>
行列の基本的な演算 + rank, det, inverse, 連立方程式の求解をガウスの消去法を用いて実装している
</p>
<p>
時間計算量: rank, det, inverse, 連立方程式の求解 O(n^3)
</p>
<h3>コード</h3>
<div class="codebox">
<input type="checkbox" id="label" class="csscode" />
<label for="label"></label>
<pre class="prettyprint linenums">
#define EPS 1e-10
#define MOD 1000000007

template&lt;typename T&gt; class mat : public vector&lt;vector&lt;T&gt; &gt; {
private:
    int r,c;    //行,列
public:
    int row() const {
        return r;
    }
    int column() const {
        return c;
    }
    mat(int n,int m,T val = 0){
        r = n, c = m;
        for(int i = 0; i &lt; n; i++){
            this-&gt;push_back(vector&lt;T&gt;(m,val));
        }
    }
    mat operator+(const mat&amp; another){
        if(r != another.r &amp;&amp; c != another.c){
            cout &lt;&lt; &quot;足し算失敗(サイズ不一致)&quot; &lt;&lt; endl;
            exit(1);
        }
        mat&lt;T&gt; X(r, c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                X[i][j] = (*this)[i][j] + another[i][j];
            }
        }
        return X;
    }
    mat operator+(const T val){
        mat&lt;T&gt; X(r,c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                X[i][j] = (*this)[i][j] + val;
            }
        }
        return X;
    }
    mat operator-(const mat&amp; another){
        if(r != another.r &amp;&amp; c != another.c){
            cout &lt;&lt; &quot;引き算失敗(サイズ不一致)&quot; &lt;&lt; endl;
            exit(1);
        }
        mat&lt;T&gt; X(r,c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                X[i][j] = (*this)[i][j] - another[i][j];
            }
        }
        return X;
    }
    mat operator-(const T val){
        mat&lt;T&gt; X(r,c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                X[i][j] = (*this)[i][j] - val;
            }
        }
        return X;
    }
    vector&lt;T&gt; operator*(const vector&lt;T&gt;&amp; another){
        if(c != (int)another.size()){
            cout &lt;&lt; &quot;掛け算失敗(サイズ不一致)&quot; &lt;&lt; endl;
            exit(1);
        }
        vector&lt;T&gt; vec(r,0);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                vec[i] += (*this)[i][j] * another[j];
            }
        }
        return vec;
    }
    mat operator*(const mat&amp; another){
        if(c != another.r){
            cout &lt;&lt; &quot;掛け算失敗(サイズ不一致)&quot; &lt;&lt; endl;
            exit(1);
        }
        mat&lt;T&gt; X(r,another.c);
        for(int i = 0; i &lt; r; i++){
            for(int k = 0; k &lt; c; k++){
                for(int j = 0; j &lt; (another.c); j++){
                    X[i][j] += (*this)[i][k]*another[k][j];
                }
            }
        }
        return X;
    }
    mat operator-(){
        mat&lt;T&gt; X(r,c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                X[i][j] = -(*this)[i][j];
            }
        }
        return X;
    }
    int rank(){
        int res = 0;
        mat B(r, c);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; c; j++){
                B[i][j] = (*this)[i][j];
            }
        }
        for(int i = 0; i &lt; c; i++){
            if(res == r) return res;
            int pivot = res;
            for(int j = res + 1; j &lt; r; j++){
                if(abs(B[j][i]) &gt; abs(B[pivot][i])){
                    pivot = j;
                }
            }
            if(abs(B[pivot][i]) &lt; EPS) continue;
            swap(B[pivot],B[res]);
            for(int j = i + 1; j &lt; c; j++){
                B[res][j] /= B[res][i];
            }
            for(int j = res + 1; j &lt; r; j++){
                for(int k = i + 1; k &lt; c; k++){
                    B[j][k] -= B[res][k]*B[j][i];
                }
            }
            res++;
        }
        return res;
    }
    T det(){
        if(r != c){
            cout &lt;&lt; &quot;正方行列でない(行列式定義不可)&quot; &lt;&lt; endl;
            exit(1);
        }
        T ans = 1;
        mat B(r, r);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; r; j++){
                B[i][j] = (*this)[i][j];
            }
        }
        for(int i = 0; i &lt; r; i++){
            for(int j = i + 1; j &lt; r; j++){
                for (; B[j][i] != 0; ans = -ans) {
                    T r = B[i][i] / B[j][i];
                    for(int k = i; k &lt; r; k++) {
                        T t = B[i][k] - r * B[j][k];
                        B[i][k] = B[j][k];
                        B[j][k] = t;
                    }
                }
           }
           ans *= B[i][i];
       }
       return ans;
    }
    mat inverse(){
        if(r != c){
            cout &lt;&lt; &quot;正方行列でない(逆行列定義不可)&quot; &lt;&lt; endl;
            exit(1);
        }
        mat B(r, 2*r);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; r; j++){
                B[i][j] = (*this)[i][j];
            }
        }
        for(int i = 0; i &lt; r; i++){
            B[i][r+i] = 1;
        }
        for(int i = 0; i &lt; r; i++){
            int pivot = i;
            for(int j = i; j &lt; r; j++){
                if(abs(B[j][i]) &gt; abs(B[pivot][i])){
                    pivot = j;
                }
            }
            if(abs(B[pivot][i]) &lt; EPS){
                cout &lt;&lt; &quot;解なしor不定&quot; &lt;&lt; endl;
                exit(1);
            }
            swap(B[i],B[pivot]);
            for(int j = i + 1; j &lt;= 2*r; j++){
                B[i][j] /= B[i][i];
            }
            for(int j = 0; j &lt; r; j++){
                if(i != j){
                    for(int k = i + 1; k &lt;= 2*r; k++){
                        B[j][k] -= B[j][i] * B[i][k];
                    }
                }
            }
        }
        mat res(r, r);
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; r; j++){
                res[i][j] = B[i][r+j];
            }
        }
        return res;
    }
    void print(){
        for(int i = 0; i &lt; r; i++){
            for(int j = 0; j &lt; (c-1); j++){
                cout &lt;&lt; (*this)[i][j] &lt;&lt; &quot;,&quot;;
            }
            cout &lt;&lt; (*this)[i][c-1] &lt;&lt; endl;
        }
    }
};

template&lt;typename T&gt; vector&lt;T&gt; eq_solve(const mat&lt;T&gt;&amp; A,const vector&lt;T&gt;&amp; b){
    if(A.row() != A.column()){
        cout &lt;&lt; &quot;正方行列でない(解なしor不定)&quot; &lt;&lt; endl;
        exit(1);
    }
    int n = A.row();
    mat&lt;T&gt; B(n,n+1);
    for(int i = 0; i &lt; n; i++){
        for(int j = 0; j &lt; n; j++){
            B[i][j] = A[i][j];
        }
    }
    for(int i = 0; i &lt; n; i++){
        B[i][n] = b[i];
    }
    for(int i = 0; i &lt; n; i++){
        int pivot = i;
        for(int j=i;j&lt;n;j++){
            if(abs(B[j][i]) &gt; abs(B[pivot][i])){
                pivot = j;
            }
        }
        if(abs(B[pivot][i]) &lt; EPS){
            cout &lt;&lt; &quot;解なしor不定&quot; &lt;&lt; endl;
            exit(1);
        }
        swap(B[i],B[pivot]);
        for(int j=i+1;j&lt;=n;j++){
            B[i][j] /= B[i][i];
        }
        for(int j = 0; j &lt; n; j++){
            if(i != j){
                for(int k=i+1;k&lt;=n;k++){
                    B[j][k] -= B[j][i] * B[i][k];
                }
            }
        }
    }
    vector&lt;T&gt; res(n);
    for(int i = 0; i &lt; n; i++){
        res[i] = B[i][n];
    }
    return res;
}

template&lt;typename T&gt; mat&lt;T&gt; pow(mat&lt;T&gt; A,long long cnt)
{
    if(A.row() != A.column()){
        cout &lt;&lt; &quot;累乗不可&quot; &lt;&lt; endl;
    }
    int n = A.row();
    mat&lt;T&gt; B(n,n);
    for(int i = 0; i &lt; n; i++){
        B[i][i] = 1;
    }
    while(cnt&gt;0){
        if(cnt &amp; 1) B = B*A;
        A = A*A;
        cnt &gt;&gt;= 1;
    }
    return B;
}

template&lt;typename T&gt; mat&lt;T&gt; mod_mul(mat&lt;T&gt;&amp; A,mat&lt;T&gt;&amp; B)
{
    if(A.column() != B.row()){
        cout &lt;&lt; &quot;掛け算失敗(サイズ不一致)&quot; &lt;&lt; endl;
        exit(1);
    }
    mat&lt;T&gt; X(A.row(),B.column());
    for(int i = 0; i &lt; A.row(); i++){
        for(int k = 0; k &lt; A.column(); k++){
            for(int j = 0; j &lt; B.column(); j++){
                X[i][j] = (X[i][j] + A[i][k]*B[k][j]) % MOD;
            }
        }
    }
    return X;
}

template&lt;typename T&gt; mat&lt;T&gt; mod_pow(mat&lt;T&gt; A,long long cnt)
{
    if(A.row() != A.column()){
        cout &lt;&lt; &quot;累乗不可&quot; &lt;&lt; endl;
    }
    int n = A.row();
    mat&lt;T&gt; B(n,n);
    for(int i = 0; i &lt; n; i++){
        B[i][i] = 1;
    }
    while(cnt&gt;0){
		if(cnt &amp; 1) B = mod_mul(B,A);
        A = mod_mul(A,A);
        cnt &gt;&gt;= 1;
    }
    return B;
}
</pre>
<h3>verify 用の問題</h3>
<p>
det の verify <br>
Atcoder : <a href="https://beta.atcoder.jp/contests/arc054/tasks/arc054_c">鯛焼き</a>
  <a href="https://beta.atcoder.jp/contests/arc054/submissions/3147285">提出コード</a><br>
eq_solve の verify <br>
AOJ : <a href="http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2315">Shadow Witch</a>
  <a href="http://judge.u-aizu.ac.jp/onlinejudge/review.jsp?rid=3123478#1">提出コード</a><br>
乗算, mod_pow の verify <br>
yukicoder : <a href="https://yukicoder.me/problems/no/569">3 x N グリッドのパスの数</a>
    <a href="https://yukicoder.me/submissions/283500">提出コード</a><br>
rank の verify はしていません (verify 問題を知らない)
</section>

</div>
<!--/contents-->

<footer>
<small>Copyright&copy; <a href="../../index.html"> My Algorithm : kopricky アルゴリズムライブラリ </a> All Rights Reserved.</small>
<span class="pr">《<a href="https://template-party.com/" target="_blank">Web Design:Template-Party</a>》</span>
</footer>

<script src="../../js/prettify.js"></script>
<script src="../../js/lang-css.js"></script>
<!-- prettyPrint()関数を実行するため追加↓ -->
<script>prettyPrint();</script>

</div>
<!--/container-->

</body>
</html>
